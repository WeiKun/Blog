# PyBot第一步——XProto2Py

最近项目中在做基于协议的自动测试用例，使用的是一个cpp写的TestClient，这个TestClient原本是后台开发时做简单的人工测试（例如使用道具的时候，输入useitem itemuuid，然后看返回的协议是否正常）。

我觉得cpp搭建的TestClient在做简单的上下文无关联的自动测试时还算好用，但是一旦涉及到状态保存或者比较复杂的逻辑验证就比较蛋疼了，最好是能用py来做。

要实现一个基于Py的TestClient（叫PyBot吧）我先需要做一个中间件，把公司内部使用的一个类似于protobuff的的消息协议XProto解析成py的数据（双向，既能解析也能打包），然后将testclient用到的网络模块tconnect编译成.so，让python来调用（或者py虚拟机编译成.so然后让tconnect来调用）。

将XProto解析成Py的工具，公司内部有不少私人版本，但是都支持地不完全，我觉得可以自己尝试下造造这个轮子。

首先考虑的是直接做二进制跟py的转换，需要对XProto的编码格式进行深入的了解，而这个协议并不公开，我需要从cpp的解析代码中去反推，成本过高。

否定了上面的方案后，我又想到，我们既然手里有XProto2Cpp的工具（根据生成xml生成一套cpp的数据结构，并且生成他们跟二进制消息之间转换的代码），我其实可以利用这套工具先生成转换到cpp的代码，然后自己写一套cpp数据结构跟py数据结构转换的代码生成器。这只需要知道cpp数据结构的命名风格即可。即便以后平台部门修改了XProto的协议格式，只要他们还提供这套工具，我把工具替换下，这套解决方案依然可以生效。

简单地规划了下开发的步骤：

 1. 完成从xml生成对应的py-class代码的模块
 2. 完成XProto-->py
 3. 完成py-->XProto

未完待续，随着开发过程踩坑再来补充。
